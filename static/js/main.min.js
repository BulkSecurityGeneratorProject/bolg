(function(){Date.prototype.format=function(format){var date={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};if(/(y+)/i.test(format)){format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in date){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?date[k]:("00"+date[k]).substr((""+date[k]).length))}}return format};var Request=(function(){var url=decodeURI(location.search);var theRequest=new Object();if(url.indexOf("?")!=-1){var str=url.substr(1);strs=str.split("&");for(var i=0;i<strs.length;i++){theRequest[strs[i].split("=")[0]]=unescape(strs[i].substr(strs[i].indexOf("=")+1))}}return theRequest})();if(Request["dp"]){var decryptedData=CryptoJS.AES.decrypt(Request["dp"],CryptoJS.enc.Utf8.parse("ud_yhy_demo_text"),{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8);Request=(function(){var strs=decryptedData.split("&");var theRequest=new Object();for(var i=0;i<strs.length;i++){theRequest[strs[i].split("=")[0]]=unescape(strs[i].substr(strs[i].indexOf("=")+1))}return theRequest})()}var h5_upload={pub_key:Request["pub_key"]||"",sign_time:Request["sign_time"]||(new Date()).format("yyyyMMddhhmmss"),sign:Request["sign"]||"",step_num:Request["step_num"],url_type:Request["url_type"]||"zs",partner_order_id:Request["partner_order_id"]||(+new Date()),package_code:Request["package_code"]||"TC010",extension_info:Request["extension_info"]||"",btn_color:Request["btn_color"]||"#12addd",finally_color:Request["finally_color"]||"url('./images/blueback.png')",callback_url:Request["callback_url"]||"",id_name:Request["id_name"]||"",id_number:Request["id_number"]||"",is_api:Request["is_api"]||"",return_url:Request["return_url"]||"",time2wait:600*1000,maxvideosize:5,nowPiczorf:1,saveHuotiCS:"ud_htcsnum",saveHuotiName:"ud_htname",reTestTime:3,timeoutTime:20*1000,minPic:{1:"",2:""},minVid:"",savePostPic1:{},savePostPic2:{},savePostPic6:{},saveInfo:{name:"",card:"",time:"",cardshow:""},return_photo:"",package_session_id:"",init:function(){var that=this;that.sign_time_date=new Date(that.sign_time.replace(/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})$/,"$1/$2/$3 $4:$5:$6"));if(that.id_name&&that.id_number){that.jianban=true}that.apiConfig=that.apiConfig();that.ErrorTip=that.ErrorTip();that.eventBind();if(that.step_num){that.showStep(that.step_num)}else{if(that.id_name&&that.id_number){if(that.is_api=="1"){that.showStep(6)}else{that.get_package_session_id();$("#agreement2").show()}}else{if(that.is_api=="1"){$("#agreement1").hide()}that.showStep(1)}}setTimeout(function(){that.initColor()},1);window.onerror=function(errMsg,scriptURI,lineNumber,columnNumber,errorObj){setTimeout(function(){var rst={"错误信息：":errMsg,"出错文件：":scriptURI,"出错行号：":lineNumber,"出错列号：":columnNumber,"错误详情：":errorObj};that.ErrorTip.show("网络异常，请重新认证",that.time2wait);setTimeout(function(){location.reload()},2000)});return false}},initColor:function(){var that=this;$("#step5").css({"background":that.finally_color,"background-size":"100% 100%"});$(".submit-btn").css({"background":that.btn_color,"background-size":"100% 100%"});if(that.is_api=="1"){$(".type-h5").remove();$(".type-api").show()}else{$(".type-api").remove();$(".type-h5").show()}if(that.isPC()){$("html").addClass("pc");$("#upload1,#upload2,#upload6").attr("accept","image/png,image/jpg,image/jpeg")}$("html").show()},isPC:function(){var userAgent=navigator.userAgent.toLowerCase();if(userAgent.indexOf("windows phone")>=0){return false}else{if(userAgent.indexOf("symbianos")>=0){return false}else{if(userAgent.indexOf("android")>=0){return false}else{if(userAgent.indexOf("iphone")>=0||userAgent.indexOf("ipad")>=0||userAgent.indexOf("iPod")>=0||userAgent.indexOf("ios")>=0){return false}else{return true}}}}},takePhoto:function(){var that=this;var videoObj={"video":true};var canvas=document.getElementById("canvas_show"),context=canvas.getContext("2d"),video=document.getElementById("video_show"),errBack=function(error){console.log("video capture error:",error.code)};navigator.myGetUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.myGetUserMedia(videoObj,function(localMediaStream){window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;video.src=window.URL.createObjectURL(localMediaStream);video.play()},errBack);video.onloadedmetadata=function(e){window.setInterval(function(){context.drawImage(video,0,0,video.videoWidth,video.videoHeight)},15);$("#snap_in").click(function(){that.showStep(1);that.minPic[that.nowPiczorf]=canvas.toDataURL("image/jpeg",1);$(".uploadpic"+that.nowPiczorf).attr("src",that.minPic[that.nowPiczorf])})}},clearInputFile:function(index){var that=this;var file=$("#upload"+index);file.after(file.clone().val(""));file.remove();that.eventBindPic(index)},eventBind:function(){var that=this;that.eventBindPic(1);
that.eventBindPic(2);that.eventBindPic(4);that.eventBindPic(6);$("#submit1").bind("click",function(){that.upload1()});$("#submit2").bind("click",function(){that.upload2()});$("#submit3").bind("click",function(){that.upload3()});$("#submit4").bind("click",function(){that.upload4()});$("#cname_edit").bind("click",function(){$("#cname").focus()});$("#submit5").bind("click",function(){if(that.return_url&&that.is_api!="1"){window.location.replace(that.return_url)}else{try{var ua=navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=="micromessenger"){WeixinJSBridge.call("closeWindow")}else{if(ua.indexOf("alipay")!=-1){AlipayJSBridge.call("closeWebview")}else{if(ua.indexOf("baidu")!=-1){BLightApp.closeWindow()}}}}catch(e){}window.opener=null;window.open("about:blank","_self");window.close()}});$("#submit6").bind("click",function(){that.upload6()})},eventBindPic:function(index){var that=this;if(index==4){$("#upload"+index).bind("click",function(event){if($("#agreement2").css("display")!="none"&&$("#isagreement2:checked").length==0){that.ErrorTip.show("请您先阅读并勾选<br>《用户协议》");event.preventDefault()}});$("#upload4").bind("change",function(){if(this.files.length&&this.files[0]){that.ErrorTip.show("加载中",that.time2wait)}else{that.ErrorTip.show("请选择视频");return}var reader=new FileReader();reader.onload=function(e){that.compressv(this.result,e)};reader.readAsDataURL(this.files[0])})}else{$("#upload"+index).bind("change",function(){if(this.files.length&&this.files[0]){that.ErrorTip.show("加载中",that.time2wait)}else{that.ErrorTip.show("请选择图片");return}var reader=new FileReader();var file=this.files[0];setTimeout(function(){lrz(file,{width:800}).then(function(rst){that.compress(rst.base64,index)})},10)})}},ajaxErrorFn:function(that,xhr,textStatus){if(textStatus=="timeout"){that.ErrorTip.show("网络超时，请稍后再试",3000)}else{that.ErrorTip.show("网络异常，请稍后再试",3000)}},ErrorTip:function(){var dom="<div  id='ErrorTipModal' class='error_tip_frame'><div class='error_tip_inner'>{{message}}</div></div>";var obj,time;function hide(){if(obj){obj.remove();obj=""}}function show(message,wait){hide();if(!message){return}if(message.indexOf("签名过期")>=0){message="操作超时，请重新认证"}obj=$(dom.replace("{{message}}",message)).appendTo("body");var waitTime=0;if(wait){waitTime=wait}else{if(message.length/6>1){waitTime=message.length*1000/(5+~~(message.length/6))}else{waitTime=1000}}time=setTimeout(function(){hide()},waitTime)}return{show:show,hide:hide}},apiConfig:function(){var that=this;var apiConfigMap={"cs":{url:"http://10.1.30.51:8000/idsafe-front/frontserver/4.2/api/"},"zs":{url:"https://idsafe-auth.udcredit.com/frontserver/4.2/api/"},"zs-a":{url:"https://idsafe-auth-a.udcredit.com/frontserver/4.2/api/"},"zs-b":{url:"https://idsafe-auth-b.udcredit.com/frontserver/4.2/api/"}};var retObj=apiConfigMap[that.url_type]?apiConfigMap[that.url_type]:apiConfigMap["zs"];if(that.pub_key){retObj.pub_key=that.pub_key;delete retObj.security_key}return retObj},compress:function(res,index){var that=this,img=new Image();that.ErrorTip.show("加载中",that.time2wait);setTimeout(function(){img.src=res},10);img.onload=function(){var cvs=document.createElement("canvas"),ctx=cvs.getContext("2d"),_offheight=0,bili=0.8;cvs.width=img.width;cvs.height=img.height;ctx.drawImage(img,0,_offheight,img.width,img.height);if(!that.isColorPhoto(ctx.getImageData(0,_offheight,img.width,img.height).data)){if(that.is_api){if(index==6){that.ErrorTip.show("请上传有效照片")}else{that.ErrorTip.show("请上传有效身份证件")}}else{if(index==6){that.ErrorTip.show("请拍摄有效照片")}else{that.ErrorTip.show("请拍摄有效身份证件")}}that.clearInputFile(index);return}that.minPic[index]=cvs.toDataURL("image/jpeg");$(".uploadpic"+index).attr("src",that.minPic[index]);$(".uploadinfo"+index).hide();that.clearInputFile(index);setTimeout(function(){that.ErrorTip.show("",1)},10)}},compressv:function(res,e){var that=this;if(e.total>that.maxvideosize*1024*1024){that.ErrorTip.show("当前视频"+(e.total/1024/1024).toFixed(2)+"MB，超过"+that.maxvideosize+"MB，请缩短拍摄时间或降低视频分辨率再上传");that.clearInputFile(4);return}that.minVid=res;that.clearInputFile(4);that.upload4()},showStep:function(index){$(".step").hide();$("#step"+index).show();if(index=="1"){$("title").html("添加身份证正面信息");$(".top-1,.top-2").show();$(".active").removeClass("active");$(".top-step1").addClass("active")}else{if(index=="2"){$("title").html("添加身份证反面信息");$(".top-1,.top-2").show();$(".active").removeClass("active");$(".top-step1,.top-step2").addClass("active")}else{if(index=="3"){$("title").html("确认信息");$(".top-1,.top-2").show();$(".active").removeClass("active");$(".top-step1,.top-step2,.top-step3").addClass("active")}else{if(index=="4"){$("title").html("验证身份");$(".top-1,.top-2").hide()}else{if(index=="5"){$("title").html("认证结果");$(".top-1,.top-2").hide()}else{if(index=="6"){$("title").html("上传正面照");$(".top-1,.top-2").hide()}}}}}}},get_package_session_id:function(){var that=this;var postData={package_code:that.package_code,partner_order_id:that.partner_order_id,extension_info:that.extension_info,sign_time:that.sign_time,id_number:that.id_number,id_name:that.id_name};
postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);function successFn(data){if(!data.result.success){that.ErrorTip.show(data.result.message||data.result.errorcode)}else{that.package_session_id=data.data.package_session_id;that.postGetValidate()}}$.ajax({type:"POST",url:that.apiConfig.url+"new_simpleauth_order/pub_key/"+that.apiConfig.pub_key+"/order_type/h5",timeout:that.timeoutTime,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})},upload1:function(){var that=this;if($("#agreement1").css("display")!="none"&&$("#isagreement1:checked").length==0){that.ErrorTip.show("请您先阅读并勾选<br>《用户协议》");return}if(!that.minPic[1]){that.ErrorTip.show("请上传身份证正面图片");that.clearInputFile(1);return}that.ErrorTip.show("正在验证，请稍候",that.time2wait);var postData={package_code:that.package_code,partner_order_id:that.partner_order_id,extension_info:that.extension_info,sign_time:that.sign_time,idcard_front_photo:that.minPic[1].substr(that.minPic[1].indexOf(",")+1,that.minPic[1].length-1)};if(that.savePostPic1[postData.idcard_front_photo]){successFn(that.savePostPic1[postData.idcard_front_photo]);return}postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);function successFn(data){that.savePostPic1[postData.idcard_front_photo]=data;if(!data.result.success){that.ErrorTip.show((data.result.message||data.result.errorcode)+"<br>请点击证件图片重新拍摄")}else{that.saveInfo.name=data.data.id_name;that.saveInfo.card=data.data.id_number;if(that.saveInfo.card.length>8){that.saveInfo.cardshow=that.saveInfo.card.substr(0,4)+"************************".substr(0,that.saveInfo.card.length-6)+that.saveInfo.card.substr(that.saveInfo.card.length-2,2)}else{that.saveInfo.card=data.data.cardshow}that.package_session_id=data.data.package_session_id;that.ErrorTip.show("验证成功",100);that.showStep(2)}that.clearInputFile(1)}$.ajax({type:"POST",url:that.apiConfig.url+"idcard_front_photo_ocr/pub_key/"+that.apiConfig.pub_key+(that.is_api?"":"/order_type/h5"),timeout:that.timeoutTime,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})},upload2:function(){var that=this;if(!that.minPic[2]){that.ErrorTip.show("请上传身份证反面图片");that.clearInputFile(2);return}that.ErrorTip.show("正在验证，请稍候",that.time2wait);var postData={package_session_id:that.package_session_id,package_code:that.package_code,partner_order_id:that.partner_order_id,extension_info:that.extension_info,sign_time:that.sign_time,idcard_back_photo:that.minPic[2].substr(that.minPic[2].indexOf(",")+1,that.minPic[2].length-1)};if(that.savePostPic2[postData.idcard_back_photo]){successFn(that.savePostPic2[postData.idcard_back_photo]);return}postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);function successFn(data){that.savePostPic2[postData.idcard_back_photo]=data;if(!data.result.success){that.ErrorTip.show((data.result.message||data.result.errorcode)+"<br>请点击证件图片重新拍摄")}else{that.saveInfo.time=data.data.validity_period;that.package_session_id=data.data.package_session_id;that.ErrorTip.show("验证成功",100);that.showStep(3);$("#cname").val(that.saveInfo.name);$("#ccard").text(that.saveInfo.cardshow);$("#ctime").text(that.saveInfo.time)}that.clearInputFile(2)}$.ajax({type:"POST",url:that.apiConfig.url+"idcard_back_photo_ocr/pub_key/"+that.apiConfig.pub_key+(that.is_api?"":"/order_type/h5"),timeout:that.timeoutTime,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})},upload3:function(){var that=this;var name=$.trim($("#cname").val());var namePattern=new RegExp("^([\u4e00-\u9fa5\u3400-\u4db5]+(·[\u4e00-\u9fa5\u3400-\u4db5]+)*)$");if(!that.package_session_id){that.ErrorTip.show("请按顺序进行验证")}else{if(!name){that.ErrorTip.show("请输入身份证姓名")}else{if(name.length<2){that.ErrorTip.show("姓名格式错误，请重新输入")}else{if(!namePattern.test(name)){that.ErrorTip.show("姓名格式错误，请重新输入")}else{if(that.saveInfo.name==$.trim($("#cname").val())){if(that.is_api=="1"){that.showStep(6)}else{that.postGetValidate()}}else{that.ErrorTip.show("正在修改姓名，请稍候",that.time2wait);var postData={package_session_id:that.package_session_id,partner_order_id:that.partner_order_id,sign_time:that.sign_time,id_name:$.trim($("#cname").val())};postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);function successFn(data){that.savePostPic2[postData.idcard_back_photo]=data;
if(!data.result.success){that.ErrorTip.show(data.result.message||data.result.errorcode)}else{that.ErrorTip.show("姓名修改成功",100);that.package_session_id=data.data.package_session_id;if(that.is_api=="1"){that.showStep(6)}else{that.postGetValidate()}}}$.ajax({type:"POST",url:that.apiConfig.url+"update_ocr_info/pub_key/"+that.apiConfig.pub_key+(that.is_api?"":"/order_type/h5"),timeout:that.timeoutTime,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})}}}}}},postGetValidate:function(){var that=this;var postData={package_session_id:that.package_session_id,package_code:that.package_code,partner_order_id:that.partner_order_id,sign_time:that.sign_time};postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);function successFn(data){if(!data.result.success){that.ErrorTip.show(data.result.message||data.result.errorcode)}else{that.ErrorTip.show("验证码获取成功",100);that.package_session_id=data.data.package_session_id;$(".take-num").text(data.data.living_validate_data);if(that.isOutOfTime()){$("#upload4").hide()}that.showStep(4)}}$.ajax({type:"POST",url:that.apiConfig.url+"get_living_validate_data/pub_key/"+that.apiConfig.pub_key+"/order_type/h5",timeout:that.timeoutTime,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})},upload4:function(){var that=this;if(!that.package_session_id){that.ErrorTip.show("请按顺序进行验证")}else{if(that.isOutOfTime()){that.ErrorTip.show("人脸认证失败次数过多，请退出重新操作。")}else{if(!that.minVid){that.ErrorTip.show("人脸认证失败次数过多，请退出重新操作。")}else{that.ErrorTip.show("人脸认证中，请稍候",that.time2wait);that.addOutOfTime();if(that.isOutOfTime()){$("#upload4").hide()}var postData={package_session_id:that.package_session_id,package_code:that.package_code,partner_order_id:that.partner_order_id,extension_info:that.extension_info,sign_time:that.sign_time,living_video:that.minVid.substr(that.minVid.indexOf(",")+1,that.minVid.length-1)};postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);function successFn(data){if(!data.result.success){that.ErrorTip.show(data.result.message||data.result.errorcode,2000);setTimeout(function(){that.postGetValidate()},2000)}else{that.package_session_id=data.data.package_session_id;that.return_photo=data.data.living_photo;that.compare()}}$.ajax({type:"POST",url:that.apiConfig.url+"living_detection/pub_key/"+that.apiConfig.pub_key+"/order_type/h5",timeout:that.timeoutTime*3,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})}}}},upload6:function(){var that=this;if(!that.minPic[6]){that.ErrorTip.show("请上传正面照");return}that.ErrorTip.show("正在验证，请稍候",that.time2wait);var postData={package_code:that.package_code,partner_order_id:that.partner_order_id,extension_info:that.extension_info,sign_time:that.sign_time,living_photo:that.minPic[6].substr(that.minPic[6].indexOf(",")+1,that.minPic[6].length-1)};var _url="";if(that.jianban){_url="single_idcard_verify_and_compare";postData.id_number=that.saveInfo.card||that.id_number;postData.id_name=that.saveInfo.name||that.id_name}else{_url="idcard_verify_and_compare";postData.package_session_id=that.package_session_id}if(that.savePostPic6[postData.living_photo]){successFn(that.savePostPic6[postData.living_photo]);return}postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);function successFn(data){that.savePostPic6[postData.idcard_front_photo]=data;if(!data.result.success){that.ErrorTip.show(data.result.message||data.result.errorcode)}else{that.ErrorTip.show("验证完成",100);if(!data.data){data.data={}}that.setEndShow(data.data.auth_result,data.data.similarity);that.showStep(5)}}$.ajax({type:"POST",url:that.apiConfig.url+_url+"/pub_key/"+that.apiConfig.pub_key,timeout:that.timeoutTime,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})},compare:function(){var that=this;that.ErrorTip.show("认证处理中，请稍候",that.time2wait);var postData={package_session_id:that.package_session_id,package_code:that.package_code,partner_order_id:that.partner_order_id,extension_info:that.extension_info,sign_time:that.sign_time,living_photo:that.return_photo};postData.sign=that.sign||hex_md5("pub_key="+that.apiConfig.pub_key+"|partner_order_id="+postData.partner_order_id+"|sign_time="+postData.sign_time+"|security_key="+that.apiConfig.security_key);
function successFn(data){if(!data.result.success&&["500006","500007","500014"].indexOf(data.result.errorcode+"")<0){that.ErrorTip.show(data.result.message||data.result.errorcode,2000);setTimeout(function(){that.postGetValidate()},2000)}else{that.ErrorTip.show("验证完成",100);if(!data.data){data.data={}}that.setEndShow(data.data.auth_result,data.data.similarity);if(data.data.auth_result=="T"){that.setInfo(that.saveHuotiName,(that.getInfo(that.saveHuotiName)||"")+(that.apiConfig.pub_key+"{{#}}"+that.saveInfo.card)+",")}if(that.callback_url){$.get(that.callback_url+(that.callback_url.indexOf("?")>-1?"&":"?")+"partner_order_id="+that.partner_order_id+"&be_idcard="+data.data.similarity+"&result_auth="+data.data.auth_result+"&ret_code="+data.data.errorcode+"&ret_msg="+data.data.message)}that.showStep(5)}}$.ajax({type:"POST",url:that.apiConfig.url+"idcard_verify_and_compare/pub_key/"+that.apiConfig.pub_key+"/order_type/h5",timeout:that.timeoutTime,data:JSON.stringify(postData),dataType:"json",headers:{"Content-Type":"application/json"},success:successFn,error:function(xhr,status){that.ajaxErrorFn(that,xhr,status)},})},isOutOfTime:function(){var that=this;var htcsList=(that.getInfo(that.saveHuotiCS)||"").split("{{htcs}}");if(htcsList.length==2&&that.partner_order_id==htcsList[0]&&htcsList[1]-that.reTestTime>=0){return true}return false},addOutOfTime:function(){var that=this;var htcsList=(that.getInfo(that.saveHuotiCS)||"").split("{{htcs}}");if(htcsList.length==2&&that.partner_order_id==htcsList[0]){htcsList[1]=(+htcsList[1])+1;that.setInfo(that.saveHuotiCS,htcsList[0]+"{{htcs}}"+htcsList[1])}else{that.setInfo(that.saveHuotiCS,that.partner_order_id+"{{htcs}}1")}},setEndShow:function(auth_result,similarity){if(similarity){similarity=(+similarity).toFixed(2)}else{similarity=0}if(!auth_result){auth_result="F"}var num_step=5;if(similarity<0.2){num_step=1}else{if(similarity<0.4){num_step=2}else{if(similarity<0.6){num_step=3}else{if(similarity<0.8){num_step=4}}}}if(similarity==0){$("#quan").attr("src","images/quan.png")}else{$("#quan").attr("src","images/num_step"+num_step+".png")}$("#like-num").text((similarity*100).toFixed(0)+"%");$("#suinfo_info").text({T:"认证通过",F:"认证未通过",C:"审核中"}[auth_result]);$(".suinfo-pan").hide();$("#suinfo_"+auth_result).show()},setInfo:function(key,value){if(!key){return}var exdate=new Date(+new Date()+30*24*60*60*1000);document.cookie=key+"="+escape(value)+";expires="+exdate.toGMTString();if(window.localStorage&&window.localStorage.setItem){window.localStorage.setItem(key,value)}if(window.sessionStorage&&window.sessionStorage.setItem){window.sessionStorage.setItem(key,value)}},getInfo:function(key){if(!key){return""}var retStr="";var arr,reg=new RegExp("(^| )"+key+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg)){retStr=unescape(arr[2])}if(!retStr&&window.localStorage&&window.localStorage.getItem){retStr=window.localStorage.getItem(key)}if(!retStr&&window.sessionStorage&&window.sessionStorage.getItem){retStr=window.sessionStorage.getItem(key)}return retStr},isColorPhoto:function(list){for(var i=0;i<list.length;i+=4){if(Math.max(list[i],list[i+1],list[i+2])-Math.min(list[i],list[i+1],list[i+2])>50){return true}}return false}};$(document).ready(function(){h5_upload.init()})})();
